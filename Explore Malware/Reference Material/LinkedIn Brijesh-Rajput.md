[[Decoding malicious PowerShell Payload](https://www.linkedin.com/pulse/decoding-malicious-powershell-payload-brijesh-rajput)](Powershell Auditing)


- **Security** :EID 4688 with command-line auditing enabled (look for any unusual process spawning from unusual location with incorrect parent and child relationship and user context). This would capture account used, process launched with information on parent process and full command line parameter used to launch it. By default process monitoring with command line auditing is not enabled on windows system, to enable it, use Group Policy Management to edit policy and browse to Computer configuration -> Policies ->Administrative Templates -> System ->Audit Process Creation. Enterprise SIEM solutions like Splunk, Carbon Black, Tanium etc. simplifies investigating process logs across enterprise.

- **System** : EID 7045(Look for any unexpected Service Creation)
- **Module Logs** : These logs records the PowerShell cmdlets that one specify to execute, check for EventCode 4103 in PowerShell / Operational logs.
- **Script block logs** : These logs capture script that is executed, check for Event Code 4104 in PowerShell/Operational logs. 

**PowerShell logs**

Another wonderful source of information is PowerShell specific logging. These logs are undeniably a crucial forensic artefacts that every examiner should look for. Each of these provide different insight into PowerShell usage. These logs are not enabled by default and can be enabled via an Administrative template in a Group Policy.

- Transcript logs : logs all PS commands typed and the output of those commands that are written to _\Users\<username>\Documents_ by default. These log are the only source to know if a script execution is successful. These logs are not enabled by default and many organisations just don't take an advantage of this goldmine. The following image shows where PS stores these logs.The contents of the logs can be seen in the subsequent image. Notice that the hello.ps1 was executed by user brijesh.rajput. You would also notice any error encountered.